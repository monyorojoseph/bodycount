{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

<!-- content block -->
{% block content %}
    <section class='container'>
        <!-- add bodycount button -->
        <div class="text-center">
            <!-- <button class="my-3 fs-6 fw-bold text-capitalize py-1 px-3 my-btn">Add new</button> -->
            <button type="button" class="my-4 fs-6 fw-bold text-capitalize py-1 px-3 my-btn" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                Add new
            </button>
        </div>
        
        <!-- Modal -->
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-body">
                  <form class="row g-3" method='post' action="{% url 'body:add_person' %}" id="add-body-form" enctype="multipart/form-data">
                    {% csrf_token %}
                      <div class="col-md-6">
                        <label for="full_name" class="form-label">Full Name</label>
                        {{ form.full_name|add_class:"form-control" }}
                      </div>
                      <div class="col-md-6">
                        <label for="phone" class="form-label">Phone</label>
                        {{ form.phone|add_class:"form-control" }}
                        
                      </div>
                      <div class="col-12">                            
                        <label for="photo" class="form-label">Upload Photo</label>
                        {{ form.photo|add_class:"form-control" }}

                      </div>
                      <div class="col-md-4">
                        <label for="age" class="form-label">Age</label>
                        {{ form.age|add_class:"form-control" }}

                      </div>
                      <div class="col-md-4">
                        <label for="location" class="form-label">Location/Town</label>
                        {{ form.location|add_class:"form-control" }}

                      </div>
                      <div class="col-md-4">
                        <label for="rating" class="form-label">Rating</label>
                        {{ form.rating|add_class:"form-control" }}

                      </div>
                      <div class="d-grid gap-2 mb-3">
                        <button type="submit" class="btn btn-outline-success">Add</button>
                      </div>
                    </form>
                    <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancel</button>
                    </div>

              </div>
            </div>
            </div>
        </div>

        <section id="content" class="mt-2 bodies-container">
          {% for person in persons_list %}
            <div class='p-0 body-card-container d-flex flex-column justify-content-center align-items-center brd'>
                <div class='body-card d-flex flex-row justify-content-between align-items-center'>
                    <img class="body-img" src="{{ person.photo_url }}" alt="{{ person.full_name }}" />
                    <div class='body-card-info'>
                        <p class="m-0"><span class='sm-text'>age: </span>{{ person.age }} </p>
                        <p class="m-0"> <span class='sm-text'>Phone: </span> {{ person.phone }} </p>
                        <p class="m-0"> <span class='sm-text'>Rating: </span> {{ person.rating }} </p>
                    </div>
                </div
                <h4> {{ person.full_name }} </h4>
            </div>
          {% empty %}
            <p class="text-center">You haven't added a peson you banged !! </p>
          {% endfor %}
        </section>
         

    </section>
{% endblock content %}

{% block javascript %}
<script>
  $(document).ready(function(){
    console.log("am ready to suffer")
    // get all bodies
    // get cookie
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    $.ajax({
      url: "{% url 'body:home' %}",
      type: "GET",
      processData: false,
      contentType: false,
      headers: {'X-CSRFToken': csrftoken},
      success: (data)=> {
        console.log(data)
      },
      error: (error)=> {
        console.log(error)
      }
    })

    })
</script>
{% endblock javascript %}